<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>–ü–æ–¥ –†–∞–∫–∏—Ç–æ–≤—ã–π –ö—É—Å—Ç–æ–∫</title>
    <meta name="description" content="Survival horror - –ø–µ—Ä–µ–æ—Å–º—ã—Å–ª–µ–Ω–∏–µ –ö—Ä–∞—Å–Ω–æ–π –®–∞–ø–æ—á–∫–∏ –≤ –∫–∞—Ä–µ–ª—å—Å–∫–∏—Ö –ª–µ—Å–∞—Ö">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #050808;
            background-image: url('bg-game.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #FFFFFF;
            font-family: 'Georgia', serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.7) 100%);
            z-index: -1;
        }
        
        #gameTitle {
            font-size: 26px;
            margin: 15px 0 5px 0;
            color: #C41E3A;
            text-shadow: 0 0 20px rgba(196, 30, 58, 0.6), 0 2px 4px rgba(0,0,0,0.8);
            letter-spacing: 4px;
            font-weight: normal;
        }
        
        #subtitle {
            font-size: 11px;
            color: #6B8E6B;
            letter-spacing: 2px;
            margin-bottom: 10px;
            font-style: italic;
        }
        
        #gameContainer {
            position: relative;
            border: 4px solid #1A2F1A;
            box-shadow: 0 0 40px rgba(0, 30, 0, 0.8), inset 0 0 20px rgba(0,0,0,0.5);
            border-radius: 3px;
        }
        
        #gameCanvas {
            display: block;
            background: #0a1a0a;
        }
        
        #ui {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 600px;
            margin: 12px 0;
            padding: 12px 20px;
            background: linear-gradient(180deg, rgba(20, 35, 20, 0.9), rgba(10, 20, 10, 0.95));
            border: 1px solid #2A4A2A;
            border-radius: 3px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .uiElement {
            font-size: 14px;
            color: #A0C0A0;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .uiElement span {
            color: #D4AF37;
            font-weight: bold;
        }
        
        #controls {
            text-align: center;
            margin: 8px 0;
            color: #4A6A4A;
            font-size: 12px;
            letter-spacing: 1px;
        }
        
        /* –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω */
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 10, 8, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .startButton {
            background: linear-gradient(180deg, #3A4A3A, #2A3A2A);
            color: #D4AF37;
            border: 2px solid #4A5A4A;
            padding: 20px 60px;
            font-size: 20px;
            font-family: 'Georgia', serif;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 4px;
            border-radius: 5px;
        }
        
        .startButton:hover {
            background: linear-gradient(180deg, #4A5A4A, #3A4A3A);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.4);
            border-color: #D4AF37;
        }
        
        .hint {
            margin-top: 20px;
            font-size: 12px;
            color: #5A6A5A;
        }
        
        /* –≠–∫—Ä–∞–Ω—ã —Å–º–µ—Ä—Ç–∏ –∏ –ø–æ–±–µ–¥—ã */
        #gameOver, #victory {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(180deg, rgba(15, 10, 10, 0.98), rgba(5, 5, 5, 0.99));
            padding: 40px 50px;
            border: 2px solid;
            border-radius: 5px;
            text-align: center;
            z-index: 1000;
            min-width: 350px;
        }
        
        #gameOver {
            border-color: #8B0000;
            box-shadow: 0 0 40px rgba(139, 0, 0, 0.4);
        }
        
        #victory {
            border-color: #D4AF37;
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.3);
        }
        
        .gameOverTitle {
            font-size: 32px;
            color: #C41E3A;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(196, 30, 58, 0.5);
            letter-spacing: 4px;
        }
        
        .victoryTitle {
            font-size: 32px;
            color: #D4AF37;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
            letter-spacing: 4px;
        }
        
        .message {
            font-size: 14px;
            margin: 20px 0;
            line-height: 1.8;
            color: #9A9A9A;
        }
        
        button {
            background: linear-gradient(180deg, #2A3A2A, #1A2A1A);
            color: #D4AF37;
            border: 1px solid #3A5A3A;
            padding: 12px 35px;
            margin: 10px;
            font-size: 14px;
            font-family: 'Georgia', serif;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 2px;
        }
        
        button:hover {
            background: linear-gradient(180deg, #3A4A3A, #2A3A2A);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }
        
        #warning {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(139, 69, 0, 0.95);
            color: #FFF;
            padding: 25px 40px;
            font-size: 24px;
            font-weight: bold;
            border: 3px solid #FF4500;
            border-radius: 5px;
            z-index: 999;
            animation: pulse 0.4s infinite;
            letter-spacing: 2px;
        }
        
        @keyframes pulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.05); }
        }
        
        #audioControls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(15, 25, 15, 0.9);
            padding: 8px;
            border-radius: 3px;
            border: 1px solid #2A4A2A;
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        #homeBtn {
            color: #8A9A8A;
            text-decoration: none;
            font-size: 11px;
            padding: 5px 10px;
            border-right: 1px solid #2A4A2A;
            margin-right: 5px;
            transition: color 0.3s;
        }
        
        #homeBtn:hover {
            color: #D4AF37;
        }
        
        #audioControls button {
            padding: 5px 12px;
            font-size: 11px;
            margin: 2px;
        }
        
        /* –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥–∂–æ–π—Å—Ç–∏–∫ */
        #joystickContainer {
            display: none;
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 150px;
            z-index: 1000;
        }

        @media (max-width: 768px), (pointer: coarse) {
            #joystickContainer {
                display: block;
                bottom: calc(30px + env(safe-area-inset-bottom, 0px));
            }
            #controls {
                display: none;
            }
            #ui {
                width: 95%;
                padding: 10px 15px;
            }
            .uiElement {
                font-size: 12px;
            }
            #gameCanvas {
                max-width: 95vw;
                max-height: 50vh;
            }
            #gameContainer {
                max-width: 95vw;
            }
            #gameTitle {
                font-size: 20px;
                letter-spacing: 2px;
            }
            #subtitle {
                font-size: 10px;
            }
            #audioControls {
                top: calc(10px + env(safe-area-inset-top, 0px));
                padding: 5px;
            }
            #audioControls button {
                padding: 4px 8px;
                font-size: 10px;
            }
            #homeBtn {
                font-size: 10px;
                padding: 4px 8px;
            }
            body {
                padding-top: env(safe-area-inset-top, 0px);
                padding-bottom: env(safe-area-inset-bottom, 0px);
            }
        }
        
        @media (max-width: 480px) {
            #gameCanvas {
                width: 100% !important;
                height: auto !important;
                max-height: 45vh;
            }
            #joystickContainer {
                width: 130px;
                height: 130px;
            }
            .joystick-base {
                width: 130px;
                height: 130px;
            }
            .joystick-stick {
                width: 50px;
                height: 50px;
            }
            #ui {
                flex-wrap: wrap;
                gap: 5px;
                justify-content: center;
            }
            .uiElement {
                font-size: 11px;
            }
        }

        .joystick-base {
            position: absolute;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(20, 40, 20, 0.7), rgba(15, 30, 15, 0.9));
            border: 2px solid #2A4A2A;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(0, 30, 0, 0.5);
        }

        .joystick-stick {
            position: absolute;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, #D4AF37, #8B7530);
            border: 2px solid #2A4A2A;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.1s;
            touch-action: none;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.4);
        }
        
        #credits {
            position: fixed;
            bottom: 8px;
            font-size: 9px;
            color: #3A4A3A;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>
    <div id="audioControls">
        <a href="index.html" id="homeBtn">‚Üê –ì–ª–∞–≤–Ω–∞—è</a>
        <button id="toggleMusic">‚ô™ –ú—É–∑—ã–∫–∞</button>
        <button id="toggleSfx">‚ô™ –ó–≤—É–∫–∏</button>
    </div>
    
    <h1 id="gameTitle">–ü–û–î –†–ê–ö–ò–¢–û–í–´–ô –ö–£–°–¢–û–ö</h1>
    <div id="subtitle">survival horror</div>
    
    <div id="ui">
        <div class="uiElement">‚ù§Ô∏è –ñ–∏–∑–Ω—å: <span id="lives">1</span></div>
        <div class="uiElement">üî¶ –§–æ–Ω–∞—Ä–∏–∫: <span id="battery">100</span>%</div>
        <div class="uiElement">üë£ –°–ª–µ–¥—ã: <span id="footprints">0</span>/5</div>
    </div>
    
    <div id="gameContainer">
        <canvas id="gameCanvas" width="600" height="600"></canvas>
        
        <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π) -->
        <div id="startScreen">
            <button class="startButton" onclick="startGame()">‚ñ∫ –ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
            <div class="hint">–ö–ª–∏–∫–Ω–∏ –∏–ª–∏ –Ω–∞–∂–º–∏ Enter</div>
        </div>
        
        <div id="warning">‚ö† –õ–û–í–£–®–ö–ê ‚ö†</div>
        
        <div id="gameOver">
            <div class="gameOverTitle">–ö–û–ù–ï–¶</div>
            <div class="message" id="deathMessage">
                –í–æ–ª–∫ –Ω–∞—Å—Ç–∏–≥ —Ç–µ–±—è –≤ –≥—É—Å—Ç–æ–º –ª–µ—Å—É...
            </div>
            <button onclick="restartGame()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
        </div>
        
        <div id="victory">
            <div class="victoryTitle">–°–ü–ê–°–ï–ù–ê</div>
            <div class="message" id="victoryMessage">
                –¢—ã –Ω–∞—à–ª–∞ –≤—ã—Ö–æ–¥ –∏–∑ –ª–µ—Å–∞.<br>
                –ë–∞–±—É—à–∫–∞ –∂–¥—ë—Ç —Ç–µ–±—è.
            </div>
            <button onclick="restartGame()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>
    </div>
    
    <div id="controls">
        WASD ‚Äî –¥–≤–∏–∂–µ–Ω–∏–µ ‚Ä¢ R ‚Äî –∑–∞–Ω–æ–≤–æ ‚Ä¢ –°–ª–µ–¥—É–π –∑–∞ —Å–ª–µ–¥–∞–º–∏ –±–∞–±—É—à–∫–∏
    </div>
    
    <div id="joystickContainer">
        <div class="joystick-base">
            <div class="joystick-stick" id="joystickStick"></div>
        </div>
    </div>
    
    <div id="credits">
        –ö–æ–º–∞–Ω–¥–∞ ¬´–ö—Ä–∞—Å–Ω–∞—è —à–∞–ø–æ—á–∫–∞¬ª: –ê.–ú–∏–Ω–µ–µ–≤, –ò.–ê–∫–∏—à–∏–Ω–∞, –ï.–ü—Ä–æ—Ö–æ—Ä–æ–≤–∞, –ù.–ü–∞—á–∫–æ—Ä–∏—è
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        const GRID_SIZE = 15;
        const CELL_SIZE = canvas.width / GRID_SIZE;
        const LIGHT_RANGE = 3;
        
        let musicEnabled = true;
        let sfxEnabled = true;
        let gameStarted = false;
        let animationFrame = 0;
        
        // –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞
        let backgroundMusic = new Audio();
        backgroundMusic.src = 'music.mp3';
        backgroundMusic.loop = true;
        backgroundMusic.volume = 0.25;
        
        // Audio Context
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —à—É–º–∞ –¥–ª—è —Ç–µ–∫—Å—Ç—É—Ä
        function seededRandom(seed) {
            const x = Math.sin(seed) * 10000;
            return x - Math.floor(x);
        }
        
        function playTone(frequency, duration, type = 'sine') {
            if (!sfxEnabled) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            gainNode.gain.setValueAtTime(0.08, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + duration);
        }
        
        function playStep() { 
            playTone(80 + Math.random() * 40, 0.08, 'square'); 
        }
        
        function playDeath() {
            if (!sfxEnabled) return;
            playTone(100, 0.6, 'sawtooth');
            setTimeout(() => playTone(70, 0.8, 'sawtooth'), 200);
            setTimeout(() => playTone(50, 1, 'sawtooth'), 500);
        }
        
        function playVictory() {
            if (!sfxEnabled) return;
            playTone(392, 0.2);
            setTimeout(() => playTone(523, 0.2), 150);
            setTimeout(() => playTone(659, 0.3), 300);
            setTimeout(() => playTone(784, 0.5), 500);
        }
        
        function playWarning() { 
            if (sfxEnabled) playTone(600, 0.15, 'square'); 
        }
        
        function playPickup() { 
            if (sfxEnabled) playTone(520, 0.1); 
        }
        
        function playWolfHowl() {
            if (!sfxEnabled) return;
            playTone(200, 0.3, 'sawtooth');
            setTimeout(() => playTone(180, 0.4, 'sawtooth'), 200);
            setTimeout(() => playTone(150, 0.5, 'sawtooth'), 400);
        }
        
        function startMusic() {
            if (!musicEnabled) return;
            backgroundMusic.play().catch(() => {});
        }
        
        function stopMusic() {
            backgroundMusic.pause();
            backgroundMusic.currentTime = 0;
        }
        
        // –õ–∞–±–∏—Ä–∏–Ω—Ç
        let maze = [];
        
        function generateMaze() {
            return [
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,0,0,1,0,0,0,0,0,0,0,1],
                [1,0,1,1,1,0,1,0,1,1,1,0,1,0,1],
                [1,0,2,0,1,0,0,0,1,0,0,0,1,0,1],
                [1,1,1,0,1,1,1,0,1,0,1,1,1,0,1],
                [1,0,0,0,2,0,0,0,0,0,0,0,0,0,1],
                [1,0,1,1,1,0,1,1,1,0,1,1,1,0,1],
                [1,0,0,0,0,0,2,0,0,0,0,5,0,0,1],
                [1,0,1,0,1,1,1,0,1,1,1,0,1,0,1],
                [1,0,1,0,0,0,2,3,0,0,0,0,1,0,1],
                [1,0,1,1,1,0,1,1,1,0,1,0,1,0,1],
                [1,0,0,0,0,0,2,0,0,0,1,0,0,0,1],
                [1,0,1,0,1,1,1,0,1,0,1,1,1,4,1],
                [1,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ];
        }
        
        let player = { x: 1, y: 1, facing: { x: 0, y: 1 } };
        let wolf = { x: 11, y: 7, patrolDir: 1 };
        let trap = { x: 7, y: 9, triggered: false };
        
        let gameState = {
            alive: true,
            won: false,
            footprintsFound: 0,
            totalFootprints: 5,
            battery: 100
        };
        
        function isWall(x, y) {
            if (x < 0 || x >= GRID_SIZE || y < 0 || y >= GRID_SIZE) return true;
            return maze[y][x] === 1;
        }
        
        // –†–∏—Å–æ–≤–∞–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ (–µ–ª—å –∫–∞—Ä–µ–ª—å—Å–∫–∞—è)
        function drawTree(x, y, seed, lit) {
            const cx = x * CELL_SIZE + CELL_SIZE / 2;
            const cy = y * CELL_SIZE + CELL_SIZE / 2;
            const size = CELL_SIZE * 0.45;
            const variation = seededRandom(seed);
            
            if (lit) {
                // –°—Ç–≤–æ–ª
                ctx.fillStyle = '#3D2817';
                ctx.fillRect(cx - 3, cy + size * 0.3, 6, size * 0.5);
                
                // –í–µ—Ç–≤–∏ –µ–ª–∏ (—Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∏)
                const green1 = `rgb(${30 + variation * 20}, ${60 + variation * 30}, ${30 + variation * 15})`;
                const green2 = `rgb(${20 + variation * 15}, ${45 + variation * 25}, ${20 + variation * 10})`;
                
                ctx.fillStyle = green2;
                ctx.beginPath();
                ctx.moveTo(cx, cy - size * 0.8);
                ctx.lineTo(cx - size * 0.7, cy + size * 0.1);
                ctx.lineTo(cx + size * 0.7, cy + size * 0.1);
                ctx.closePath();
                ctx.fill();
                
                ctx.fillStyle = green1;
                ctx.beginPath();
                ctx.moveTo(cx, cy - size * 0.5);
                ctx.lineTo(cx - size * 0.5, cy + size * 0.4);
                ctx.lineTo(cx + size * 0.5, cy + size * 0.4);
                ctx.closePath();
                ctx.fill();
            } else {
                // –¢—ë–º–Ω—ã–π —Å–∏–ª—É—ç—Ç
                ctx.fillStyle = '#0A150A';
                ctx.beginPath();
                ctx.moveTo(cx, cy - size * 0.8);
                ctx.lineTo(cx - size * 0.7, cy + size * 0.5);
                ctx.lineTo(cx + size * 0.7, cy + size * 0.5);
                ctx.closePath();
                ctx.fill();
            }
        }
        
        // –†–∏—Å–æ–≤–∞–Ω–∏–µ –º—Ö–∞ –∏ –∫–∞–º–Ω–µ–π
        function drawGroundDetail(x, y, seed) {
            const cx = x * CELL_SIZE;
            const cy = y * CELL_SIZE;
            const r = seededRandom(seed);
            
            // –ú–æ—Ö
            if (r > 0.6) {
                ctx.fillStyle = 'rgba(60, 90, 50, 0.3)';
                ctx.beginPath();
                ctx.arc(cx + r * CELL_SIZE, cy + (1-r) * CELL_SIZE, 5 + r * 5, 0, Math.PI * 2);
                ctx.fill();
            }
            
            // –ö–∞–º–Ω–∏
            if (r > 0.8) {
                ctx.fillStyle = 'rgba(80, 80, 70, 0.4)';
                ctx.beginPath();
                ctx.ellipse(cx + r * CELL_SIZE * 0.8, cy + CELL_SIZE * 0.7, 4 + r * 4, 3 + r * 3, 0, 0, Math.PI * 2);
                ctx.fill();
            }
        }
        
        // –ö—Ä–∞—Å–Ω–∞—è –®–∞–ø–æ—á–∫–∞ (—É–ª—É—á—à–µ–Ω–Ω–∞—è)
        function drawRedRidingHood(x, y) {
            const cx = x * CELL_SIZE + CELL_SIZE / 2;
            const cy = y * CELL_SIZE + CELL_SIZE / 2;
            const s = CELL_SIZE / 2.2;
            
            // –¢–µ–Ω—å
            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.beginPath();
            ctx.ellipse(cx, cy + s * 0.7, s * 0.5, s * 0.2, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // –ü–ª–∞—â (—Ä–∞–∑–≤–µ–≤–∞–µ—Ç—Å—è) - –Ø–†–ö–ò–ô
            const waveOffset = Math.sin(animationFrame * 0.1) * 2;
            ctx.fillStyle = '#CC0000';
            ctx.beginPath();
            ctx.moveTo(cx - s * 0.5, cy - s * 0.3);
            ctx.quadraticCurveTo(cx - s * 0.7 + waveOffset, cy + s * 0.3, cx - s * 0.4, cy + s * 0.6);
            ctx.lineTo(cx + s * 0.4, cy + s * 0.6);
            ctx.quadraticCurveTo(cx + s * 0.7 - waveOffset, cy + s * 0.3, cx + s * 0.5, cy - s * 0.3);
            ctx.closePath();
            ctx.fill();
            
            // –ö–∞–ø—é—à–æ–Ω - –Ø–†–ö–ò–ô
            ctx.fillStyle = '#DD2222';
            ctx.beginPath();
            ctx.arc(cx, cy - s * 0.2, s * 0.5, Math.PI, 0, false);
            ctx.fill();
            
            ctx.fillStyle = '#CC0000';
            ctx.beginPath();
            ctx.moveTo(cx - s * 0.45, cy - s * 0.2);
            ctx.quadraticCurveTo(cx, cy - s * 0.9, cx + s * 0.45, cy - s * 0.2);
            ctx.closePath();
            ctx.fill();
            
            // –õ–∏—Ü–æ
            ctx.fillStyle = '#FFDAB9';
            ctx.beginPath();
            ctx.arc(cx, cy - s * 0.15, s * 0.32, 0, Math.PI * 2);
            ctx.fill();
            
            // –ì–ª–∞–∑–∞
            ctx.fillStyle = '#2F1810';
            ctx.beginPath();
            ctx.arc(cx - s * 0.12, cy - s * 0.22, s * 0.06, 0, Math.PI * 2);
            ctx.arc(cx + s * 0.12, cy - s * 0.22, s * 0.06, 0, Math.PI * 2);
            ctx.fill();
            
            // –ë–ª–∏–∫–∏ –≥–ª–∞–∑
            ctx.fillStyle = '#FFFFFF';
            ctx.beginPath();
            ctx.arc(cx - s * 0.1, cy - s * 0.24, s * 0.02, 0, Math.PI * 2);
            ctx.arc(cx + s * 0.14, cy - s * 0.24, s * 0.02, 0, Math.PI * 2);
            ctx.fill();
            
            // –ö–æ—Ä–∑–∏–Ω–∫–∞
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.ellipse(cx + s * 0.35, cy + s * 0.35, s * 0.2, s * 0.15, 0.3, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = '#5D3A1A';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.arc(cx + s * 0.35, cy + s * 0.2, s * 0.15, Math.PI, 0, true);
            ctx.stroke();
            
            // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞—Ä–∏–∫–∞
            const fx = cx + player.facing.x * s * 0.6;
            const fy = cy + player.facing.y * s * 0.6;
            
            // –õ—É—á —Ñ–æ–Ω–∞—Ä–∏–∫–∞ - –Ø–†–ö–ò–ô
            const gradient = ctx.createRadialGradient(cx, cy, 0, fx, fy, s * 2);
            gradient.addColorStop(0, 'rgba(255, 240, 150, 0.5)');
            gradient.addColorStop(0.5, 'rgba(255, 220, 100, 0.3)');
            gradient.addColorStop(1, 'rgba(255, 220, 100, 0)');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(fx, fy, s * 2, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // –í–æ–ª–∫
        function drawWolf(x, y, lit) {
            const cx = x * CELL_SIZE + CELL_SIZE / 2;
            const cy = y * CELL_SIZE + CELL_SIZE / 2;
            const s = CELL_SIZE / 2.5;
            
            if (lit) {
                // –¢–µ–ª–æ –≤–æ–ª–∫–∞
                ctx.fillStyle = '#3A3A3A';
                ctx.beginPath();
                ctx.ellipse(cx, cy + s * 0.1, s * 0.7, s * 0.5, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // –ì–æ–ª–æ–≤–∞
                ctx.fillStyle = '#4A4A4A';
                ctx.beginPath();
                ctx.ellipse(cx, cy - s * 0.3, s * 0.45, s * 0.4, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // –£—à–∏
                ctx.fillStyle = '#3A3A3A';
                ctx.beginPath();
                ctx.moveTo(cx - s * 0.3, cy - s * 0.5);
                ctx.lineTo(cx - s * 0.15, cy - s * 0.9);
                ctx.lineTo(cx, cy - s * 0.5);
                ctx.fill();
                ctx.beginPath();
                ctx.moveTo(cx + s * 0.3, cy - s * 0.5);
                ctx.lineTo(cx + s * 0.15, cy - s * 0.9);
                ctx.lineTo(cx, cy - s * 0.5);
                ctx.fill();
                
                // –ì–ª–∞–∑–∞ (–≥–æ—Ä—è—â–∏–µ) - –Ø–†–ö–ò–ï
                ctx.fillStyle = '#FF6600';
                ctx.shadowColor = '#FF4400';
                ctx.shadowBlur = 15;
                ctx.beginPath();
                ctx.arc(cx - s * 0.15, cy - s * 0.35, s * 0.1, 0, Math.PI * 2);
                ctx.arc(cx + s * 0.15, cy - s * 0.35, s * 0.1, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
                
                // –ó—Ä–∞—á–∫–∏
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.arc(cx - s * 0.15, cy - s * 0.35, s * 0.03, 0, Math.PI * 2);
                ctx.arc(cx + s * 0.15, cy - s * 0.35, s * 0.03, 0, Math.PI * 2);
                ctx.fill();
                
                // –ù–æ—Å
                ctx.fillStyle = '#1A1A1A';
                ctx.beginPath();
                ctx.arc(cx, cy - s * 0.15, s * 0.08, 0, Math.PI * 2);
                ctx.fill();
            } else {
                // –¢–æ–ª—å–∫–æ –≥–ª–∞–∑–∞ –≤ —Ç–µ–º–Ω–æ—Ç–µ - –Ø–†–ö–ò–ï
                const dist = Math.abs(player.x - x) + Math.abs(player.y - y);
                if (dist <= 6) {
                    ctx.fillStyle = '#FF6600';
                    ctx.shadowColor = '#FF4400';
                    ctx.shadowBlur = 20;
                    ctx.beginPath();
                    ctx.arc(cx - s * 0.2, cy - s * 0.1, s * 0.15, 0, Math.PI * 2);
                    ctx.arc(cx + s * 0.2, cy - s * 0.1, s * 0.15, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }
            }
        }
        
        function isLit(x, y) {
            if (x === player.x && y === player.y) return true;
            for (let i = 1; i <= LIGHT_RANGE; i++) {
                const checkX = player.x + player.facing.x * i;
                const checkY = player.y + player.facing.y * i;
                if (checkX === x && checkY === y) return true;
                if (isWall(checkX, checkY)) break;
            }
            return false;
        }
        
        function draw() {
            animationFrame++;
            
            // –§–æ–Ω ‚Äî –Ω–æ—á–Ω–æ–π –ª–µ—Å
            ctx.fillStyle = '#050A08';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º –∫–ª–µ—Ç–∫–∏
            for (let y = 0; y < GRID_SIZE; y++) {
                for (let x = 0; x < GRID_SIZE; x++) {
                    const lit = isLit(x, y);
                    const seed = x * 17 + y * 31;
                    
                    if (lit) {
                        // –û—Å–≤–µ—â—ë–Ω–Ω—ã–µ –∫–ª–µ—Ç–∫–∏
                        if (maze[y][x] === 1) {
                            // –°—Ç–µ–Ω–∞ = –¥–µ—Ä–µ–≤—å—è
                            ctx.fillStyle = '#1A2A1A';
                            ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                            drawTree(x, y, seed, true);
                        } else {
                            // –ü–æ–ª = –ª–µ—Å–Ω–∞—è –∑–µ–º–ª—è
                            ctx.fillStyle = '#1E2E1E';
                            ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                            drawGroundDetail(x, y, seed);
                        }
                        
                        // –°–ª–µ–¥—ã –±–∞–±—É—à–∫–∏
                        if (maze[y][x] === 2) {
                            ctx.fillStyle = 'rgba(180, 160, 140, 0.7)';
                            ctx.font = '18px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('üë£', x * CELL_SIZE + CELL_SIZE / 2, y * CELL_SIZE + CELL_SIZE / 2 + 6);
                        }
                        
                        // –í—ã—Ö–æ–¥
                        if (maze[y][x] === 4) {
                            // –°–≤–µ—Ç –∏–∑ –≤—ã—Ö–æ–¥–∞
                            const glow = ctx.createRadialGradient(
                                x * CELL_SIZE + CELL_SIZE / 2,
                                y * CELL_SIZE + CELL_SIZE / 2,
                                0,
                                x * CELL_SIZE + CELL_SIZE / 2,
                                y * CELL_SIZE + CELL_SIZE / 2,
                                CELL_SIZE
                            );
                            glow.addColorStop(0, 'rgba(255, 220, 150, 0.4)');
                            glow.addColorStop(1, 'rgba(255, 220, 150, 0)');
                            ctx.fillStyle = glow;
                            ctx.fillRect((x-0.5) * CELL_SIZE, (y-0.5) * CELL_SIZE, CELL_SIZE * 2, CELL_SIZE * 2);
                            
                            ctx.fillStyle = '#D4AF37';
                            ctx.font = '22px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('üö™', x * CELL_SIZE + CELL_SIZE / 2, y * CELL_SIZE + CELL_SIZE / 2 + 7);
                        }
                        
                        // –õ–æ–≤—É—à–∫–∞
                        if (x === trap.x && y === trap.y && !trap.triggered) {
                            ctx.fillStyle = '#CD853F';
                            ctx.font = '18px Arial';
                            ctx.textAlign = 'center';
                            ctx.fillText('‚ö†', x * CELL_SIZE + CELL_SIZE / 2, y * CELL_SIZE + CELL_SIZE / 2 + 6);
                        }
                        
                        // –í–æ–ª–∫
                        if (x === wolf.x && y === wolf.y) {
                            drawWolf(x, y, true);
                        }
                    } else {
                        // –ù–µ–æ—Å–≤–µ—â—ë–Ω–Ω—ã–µ ‚Äî —Ç—ë–º–Ω—ã–π –ª–µ—Å
                        ctx.fillStyle = '#060C08';
                        ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                        
                        // –°–∏–ª—É—ç—Ç—ã –¥–µ—Ä–µ–≤—å–µ–≤
                        if (maze[y][x] === 1) {
                            drawTree(x, y, seed, false);
                        }
                        
                        // –í–æ–ª–∫ –≤ —Ç–µ–º–Ω–æ—Ç–µ (—Ç–æ–ª—å–∫–æ –≥–ª–∞–∑–∞)
                        if (x === wolf.x && y === wolf.y) {
                            drawWolf(x, y, false);
                        }
                        
                        // –¢—É–º–∞–Ω
                        const fogAlpha = 0.1 + seededRandom(seed + animationFrame * 0.001) * 0.1;
                        ctx.fillStyle = `rgba(20, 40, 30, ${fogAlpha})`;
                        ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                    }
                }
            }
            
            // –õ—É—á —Ñ–æ–Ω–∞—Ä–∏–∫–∞
            ctx.globalAlpha = 0.25;
            for (let i = 1; i <= LIGHT_RANGE; i++) {
                const lx = player.x + player.facing.x * i;
                const ly = player.y + player.facing.y * i;
                if (isWall(lx, ly)) break;
                
                const alpha = (1 - (i / LIGHT_RANGE)) * 0.35;
                ctx.globalAlpha = alpha;
                
                const gradient = ctx.createRadialGradient(
                    lx * CELL_SIZE + CELL_SIZE / 2,
                    ly * CELL_SIZE + CELL_SIZE / 2,
                    0,
                    lx * CELL_SIZE + CELL_SIZE / 2,
                    ly * CELL_SIZE + CELL_SIZE / 2,
                    CELL_SIZE / 1.5
                );
                gradient.addColorStop(0, '#FFE4A0');
                gradient.addColorStop(1, 'transparent');
                ctx.fillStyle = gradient;
                ctx.fillRect(lx * CELL_SIZE, ly * CELL_SIZE, CELL_SIZE, CELL_SIZE);
            }
            ctx.globalAlpha = 1;
            
            // –ò–≥—Ä–æ–∫
            drawRedRidingHood(player.x, player.y);
            
            // –í–∏–Ω—å–µ—Ç–∫–∞ –ø–æ –∫—Ä–∞—è–º
            const vignette = ctx.createRadialGradient(
                canvas.width / 2, canvas.height / 2, canvas.width * 0.3,
                canvas.width / 2, canvas.height / 2, canvas.width * 0.7
            );
            vignette.addColorStop(0, 'transparent');
            vignette.addColorStop(1, 'rgba(0, 0, 0, 0.4)');
            ctx.fillStyle = vignette;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        
        function moveWolf() {
            const newX = wolf.x + wolf.patrolDir;
            if (newX <= 9 || newX >= 13) wolf.patrolDir *= -1;
            wolf.x += wolf.patrolDir;
        }
        
        function checkCollision() {
            if (player.x === wolf.x && player.y === wolf.y) {
                die('–í–æ–ª–∫ –Ω–∞—Å—Ç–∏–≥ —Ç–µ–±—è –≤ —á–∞—â–µ –ª–µ—Å–∞...');
                return;
            }
            
            if (player.x === trap.x && player.y === trap.y && !trap.triggered) {
                triggerTrap();
                return;
            }
            
            if (maze[player.y][player.x] === 2) {
                maze[player.y][player.x] = 0;
                gameState.footprintsFound++;
                playPickup();
                updateUI();
            }
            
            if (maze[player.y][player.x] === 4) {
                win();
            }
        }
        
        function triggerTrap() {
            trap.triggered = true;
            document.getElementById('warning').style.display = 'block';
            playWarning();
            
            setTimeout(() => {
                document.getElementById('warning').style.display = 'none';
                if (player.x === trap.x && player.y === trap.y) {
                    die('–ë—Ä–µ–≤–Ω–æ –æ–±—Ä—É—à–∏–ª–æ—Å—å –Ω–∞ —Ç–µ–±—è...');
                } else {
                    trap.triggered = false;
                }
            }, 1000);
        }
        
        function die(message) {
            if (!gameState.alive) return;
            gameState.alive = false;
            playDeath();
            stopMusic();
            document.getElementById('lives').textContent = '0';
            
            setTimeout(() => {
                document.getElementById('deathMessage').innerHTML = message;
                document.getElementById('gameOver').style.display = 'block';
            }, 600);
        }
        
        function win() {
            if (gameState.won) return;
            gameState.won = true;
            playVictory();
            stopMusic();
            
            let msg = '–¢—ã –Ω–∞—à–ª–∞ –≤—ã—Ö–æ–¥ –∏–∑ –ª–µ—Å–∞.';
            if (gameState.footprintsFound >= 5) {
                msg += '<br><br><em>–í—Å–µ —Å–ª–µ–¥—ã –±–∞–±—É—à–∫–∏ –Ω–∞–π–¥–µ–Ω—ã.</em>';
            }
            msg += '<br><br>–ë–∞–±—É—à–∫–∞ –∂–¥—ë—Ç —Ç–µ–±—è –¥–æ–º–∞.';
            
            setTimeout(() => {
                document.getElementById('victoryMessage').innerHTML = msg;
                document.getElementById('victory').style.display = 'block';
            }, 600);
        }
        
        function updateUI() {
            document.getElementById('footprints').textContent = gameState.footprintsFound;
            document.getElementById('battery').textContent = gameState.battery;
        }
        
        function movePlayer(dx, dy) {
            if (!gameState.alive || gameState.won || !gameStarted) return;
            
            const newX = player.x + dx;
            const newY = player.y + dy;
            
            if (isWall(newX, newY)) {
                playTone(150, 0.05, 'square');
                return;
            }
            
            player.x = newX;
            player.y = newY;
            player.facing = { x: dx, y: dy };
            
            // –†–∞—Å—Ö–æ–¥ –±–∞—Ç–∞—Ä–µ–π–∫–∏
            gameState.battery = Math.max(0, gameState.battery - 1);
            
            playStep();
            moveWolf();
            checkCollision();
            updateUI();
            draw();
            
            // –°–ª—É—á–∞–π–Ω—ã–π –≤–æ–π –≤–æ–ª–∫–∞
            const wolfDist = Math.abs(player.x - wolf.x) + Math.abs(player.y - wolf.y);
            if (wolfDist <= 4 && Math.random() < 0.2) {
                playWolfHowl();
            }
        }
        
        function startGame() {
            gameStarted = true;
            document.getElementById('startScreen').style.display = 'none';
            startMusic();
            draw();
            gameLoop();
        }
        
        function gameLoop() {
            if (gameStarted && gameState.alive && !gameState.won) {
                draw();
                requestAnimationFrame(gameLoop);
            }
        }
        
        function restartGame() {
            maze = generateMaze();
            player = { x: 1, y: 1, facing: { x: 0, y: 1 } };
            wolf = { x: 11, y: 7, patrolDir: 1 };
            trap = { x: 7, y: 9, triggered: false };
            gameState = {
                alive: true,
                won: false,
                footprintsFound: 0,
                totalFootprints: 5,
                battery: 100
            };
            
            document.getElementById('lives').textContent = '1';
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('victory').style.display = 'none';
            
            updateUI();
            startMusic();
            draw();
            gameLoop();
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        document.addEventListener('keydown', (e) => {
            if (!gameStarted && (e.key === 'Enter' || e.key === ' ')) {
                startGame();
                return;
            }
            
            switch(e.key.toLowerCase()) {
                case 'w': case '—Ü': case 'arrowup':
                    movePlayer(0, -1); break;
                case 's': case '—ã': case 'arrowdown':
                    movePlayer(0, 1); break;
                case 'a': case '—Ñ': case 'arrowleft':
                    movePlayer(-1, 0); break;
                case 'd': case '–≤': case 'arrowright':
                    movePlayer(1, 0); break;
                case 'r': case '–∫':
                    restartGame(); break;
            }
        });
        
        // –ê—É–¥–∏–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
        document.getElementById('toggleMusic').addEventListener('click', function() {
            musicEnabled = !musicEnabled;
            if (musicEnabled && gameStarted) {
                backgroundMusic.play();
                this.textContent = '‚ô™ –ú—É–∑—ã–∫–∞';
            } else {
                backgroundMusic.pause();
                this.textContent = '‚ô™ –í—ã–∫–ª';
            }
        });
        
        document.getElementById('toggleSfx').addEventListener('click', function() {
            sfxEnabled = !sfxEnabled;
            this.textContent = sfxEnabled ? '‚ô™ –ó–≤—É–∫–∏' : '‚ô™ –í—ã–∫–ª';
        });
        
        // –ê–≤—Ç–æ—Å—Ç–∞—Ä—Ç –º—É–∑—ã–∫–∏ –ø–æ –∫–ª–∏–∫—É
        let musicStarted = false;
        document.addEventListener('click', () => {
            if (!musicStarted && musicEnabled && gameStarted) {
                startMusic();
                musicStarted = true;
            }
        }, { once: false });

        // –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥–∂–æ–π—Å—Ç–∏–∫
        const joystickStick = document.getElementById('joystickStick');
        const joystickContainer = document.getElementById('joystickContainer');

        let joystickActive = false;
        let joystickCenterX = 0;
        let joystickCenterY = 0;
        let currentDirection = null;
        let moveInterval = null;

        function handleJoystickStart(e) {
            e.preventDefault();
            joystickActive = true;
            const rect = joystickContainer.getBoundingClientRect();
            joystickCenterX = rect.left + rect.width / 2;
            joystickCenterY = rect.top + rect.height / 2;
            
            if (!gameStarted) startGame();
        }

        function handleJoystickMove(e) {
            if (!joystickActive) return;
            e.preventDefault();

            const touch = e.touches ? e.touches[0] : e;
            const deltaX = touch.clientX - joystickCenterX;
            const deltaY = touch.clientY - joystickCenterY;

            const maxDistance = 40;
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            
            let stickX = deltaX;
            let stickY = deltaY;

            if (distance > maxDistance) {
                stickX = (deltaX / distance) * maxDistance;
                stickY = (deltaY / distance) * maxDistance;
            }

            joystickStick.style.transform = `translate(calc(-50% + ${stickX}px), calc(-50% + ${stickY}px))`;

            const angle = Math.atan2(deltaY, deltaX);
            const degrees = angle * 180 / Math.PI;
            let newDirection = null;

            if (Math.min(distance, maxDistance) > 15) {
                if (degrees >= -45 && degrees < 45) newDirection = 'right';
                else if (degrees >= 45 && degrees < 135) newDirection = 'down';
                else if (degrees >= -135 && degrees < -45) newDirection = 'up';
                else newDirection = 'left';
            }

            if (newDirection !== currentDirection) {
                currentDirection = newDirection;
                if (moveInterval) {
                    clearInterval(moveInterval);
                    moveInterval = null;
                }
                if (currentDirection) {
                    makeJoystickMove(currentDirection);
                    moveInterval = setInterval(() => makeJoystickMove(currentDirection), 180);
                }
            }
        }

        function makeJoystickMove(dir) {
            switch(dir) {
                case 'up': movePlayer(0, -1); break;
                case 'down': movePlayer(0, 1); break;
                case 'left': movePlayer(-1, 0); break;
                case 'right': movePlayer(1, 0); break;
            }
        }

        function handleJoystickEnd(e) {
            e.preventDefault();
            joystickActive = false;
            currentDirection = null;
            joystickStick.style.transform = 'translate(-50%, -50%)';
            if (moveInterval) {
                clearInterval(moveInterval);
                moveInterval = null;
            }
        }

        joystickStick.addEventListener('touchstart', handleJoystickStart, { passive: false });
        joystickStick.addEventListener('touchmove', handleJoystickMove, { passive: false });
        joystickStick.addEventListener('touchend', handleJoystickEnd, { passive: false });
        joystickStick.addEventListener('touchcancel', handleJoystickEnd, { passive: false });
        joystickStick.addEventListener('mousedown', handleJoystickStart);
        document.addEventListener('mousemove', (e) => { if (joystickActive) handleJoystickMove(e); });
        document.addEventListener('mouseup', handleJoystickEnd);

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        maze = generateMaze();
        draw();
    </script>
</body>
</html>
