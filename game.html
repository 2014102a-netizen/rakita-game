<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>–ü–æ–¥ –†–∞–∫–∏—Ç–æ–≤—ã–π –ö—É—Å—Ç–æ–∫</title>
    <meta name="description" content="Survival horror - –ø–µ—Ä–µ–æ—Å–º—ã—Å–ª–µ–Ω–∏–µ –ö—Ä–∞—Å–Ω–æ–π –®–∞–ø–æ—á–∫–∏ –≤ –∫–∞—Ä–µ–ª—å—Å–∫–∏—Ö –ª–µ—Å–∞—Ö">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #050808;
            background-image: url('bg-game.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: #FFFFFF;
            font-family: 'Georgia', serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.7) 100%);
            z-index: -1;
        }
        
        #gameTitle {
            font-size: 26px;
            margin: 15px 0 5px 0;
            color: #C41E3A;
            text-shadow: 0 0 20px rgba(196, 30, 58, 0.6), 0 2px 4px rgba(0,0,0,0.8);
            letter-spacing: 4px;
            font-weight: normal;
        }
        
        #subtitle {
            font-size: 11px;
            color: #6B8E6B;
            letter-spacing: 2px;
            margin-bottom: 10px;
            font-style: italic;
        }
        
        #gameContainer {
            position: relative;
            border: 4px solid #1A2F1A;
            box-shadow: 0 0 40px rgba(0, 30, 0, 0.8), inset 0 0 20px rgba(0,0,0,0.5);
            border-radius: 3px;
        }
        
        #gameCanvas {
            display: block;
            background: #0a1a0a;
        }
        
        #ui {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 600px;
            margin: 12px 0;
            padding: 12px 20px;
            background: linear-gradient(180deg, rgba(20, 35, 20, 0.9), rgba(10, 20, 10, 0.95));
            border: 1px solid #2A4A2A;
            border-radius: 3px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .uiElement {
            font-size: 14px;
            color: #A0C0A0;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .uiElement span {
            color: #D4AF37;
            font-weight: bold;
        }
        
        #levelIndicator {
            color: #C41E3A;
            font-weight: bold;
        }
        
        #controls {
            text-align: center;
            margin: 8px 0;
            color: #4A6A4A;
            font-size: 12px;
            letter-spacing: 1px;
        }
        
        /* –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω */
        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 10, 8, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .startButton {
            background: linear-gradient(180deg, #3A4A3A, #2A3A2A);
            color: #D4AF37;
            border: 2px solid #4A5A4A;
            padding: 20px 60px;
            font-size: 20px;
            font-family: 'Georgia', serif;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 4px;
            border-radius: 5px;
        }
        
        .startButton:hover {
            background: linear-gradient(180deg, #4A5A4A, #3A4A3A);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.4);
            border-color: #D4AF37;
        }
        
        .hint {
            margin-top: 20px;
            font-size: 12px;
            color: #5A6A5A;
        }
        
        /* –î–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ */
        #dialogueScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 10, 8, 0.95);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }
        
        .dialogueBox {
            max-width: 500px;
            background: linear-gradient(180deg, rgba(20, 35, 20, 0.95), rgba(10, 20, 10, 0.98));
            border: 2px solid #3A5A3A;
            border-radius: 8px;
            padding: 30px 40px;
            text-align: center;
        }
        
        .dialogueTitle {
            font-size: 24px;
            color: #C41E3A;
            margin-bottom: 20px;
            text-shadow: 0 0 15px rgba(196, 30, 58, 0.5);
        }
        
        .dialogueText {
            font-size: 16px;
            color: #9AB09A;
            line-height: 1.8;
            margin-bottom: 25px;
        }
        
        .dialogueText em {
            color: #D4AF37;
            font-style: normal;
        }
        
        .continueButton {
            background: linear-gradient(180deg, #3A4A3A, #2A3A2A);
            color: #D4AF37;
            border: 2px solid #4A5A4A;
            padding: 12px 40px;
            font-size: 16px;
            font-family: 'Georgia', serif;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 2px;
            border-radius: 5px;
        }
        
        .continueButton:hover {
            background: linear-gradient(180deg, #4A5A4A, #3A4A3A);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.3);
            border-color: #D4AF37;
        }
        
        /* –≠–∫—Ä–∞–Ω—ã –∫–æ–Ω—Ü–∞ –∏–≥—Ä—ã */
        #gameOver, #victory {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        #gameOver {
            background: linear-gradient(180deg, rgba(15, 10, 10, 0.98), rgba(5, 5, 5, 0.99));
        }
        
        #victory {
            background: linear-gradient(180deg, rgba(10, 15, 10, 0.98), rgba(5, 10, 5, 0.99));
        }
        
        .endBox {
            max-width: 450px;
            padding: 40px 50px;
            border-radius: 5px;
            text-align: center;
        }
        
        #gameOver .endBox {
            border: 2px solid #8B0000;
            box-shadow: 0 0 40px rgba(139, 0, 0, 0.4);
            background: rgba(20, 10, 10, 0.9);
        }
        
        #victory .endBox {
            border: 2px solid #D4AF37;
            box-shadow: 0 0 40px rgba(212, 175, 55, 0.4);
            background: rgba(15, 20, 15, 0.9);
        }
        
        .endTitle {
            font-size: 28px;
            margin-bottom: 15px;
        }
        
        #gameOver .endTitle {
            color: #C41E3A;
            text-shadow: 0 0 20px rgba(196, 30, 58, 0.5);
        }
        
        #victory .endTitle {
            color: #D4AF37;
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
        }
        
        .endMessage {
            font-size: 14px;
            color: #9A9A9A;
            line-height: 1.8;
            margin-bottom: 25px;
        }
        
        .restartButton {
            background: linear-gradient(180deg, #3A4A3A, #2A3A2A);
            color: #D4AF37;
            border: 2px solid #4A5A4A;
            padding: 12px 35px;
            font-size: 14px;
            font-family: 'Georgia', serif;
            cursor: pointer;
            transition: all 0.3s;
            letter-spacing: 2px;
        }
        
        .restartButton:hover {
            background: linear-gradient(180deg, #4A5A4A, #3A4A3A);
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }
        
        #audioControls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(15, 25, 15, 0.9);
            padding: 8px;
            border-radius: 3px;
            border: 1px solid #2A4A2A;
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        #homeBtn {
            color: #8A9A8A;
            text-decoration: none;
            font-size: 11px;
            padding: 5px 10px;
            border-right: 1px solid #2A4A2A;
            margin-right: 5px;
            transition: color 0.3s;
        }
        
        #homeBtn:hover {
            color: #D4AF37;
        }
        
        #audioControls button {
            background: linear-gradient(180deg, #2A3A2A, #1A2A1A);
            color: #8A9A8A;
            border: 1px solid #3A4A3A;
            padding: 5px 10px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Georgia', serif;
        }
        
        #audioControls button:hover {
            background: linear-gradient(180deg, #3A4A3A, #2A3A2A);
            color: #D4AF37;
        }
        
        #joystickContainer {
            display: none;
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 150px;
            height: 150px;
            z-index: 1000;
        }

        @media (max-width: 768px), (pointer: coarse) {
            #joystickContainer {
                display: block;
                bottom: calc(30px + env(safe-area-inset-bottom, 0px));
            }
            #controls {
                display: none;
            }
            #ui {
                width: 95%;
                padding: 10px 15px;
            }
            .uiElement {
                font-size: 12px;
            }
            #gameCanvas {
                max-width: 95vw;
                max-height: 50vh;
            }
            #gameContainer {
                max-width: 95vw;
            }
            #gameTitle {
                font-size: 20px;
                letter-spacing: 2px;
            }
            #subtitle {
                font-size: 10px;
            }
            #audioControls {
                top: calc(10px + env(safe-area-inset-top, 0px));
                padding: 5px;
            }
            #audioControls button {
                padding: 4px 8px;
                font-size: 10px;
            }
            #homeBtn {
                font-size: 10px;
                padding: 4px 8px;
            }
            body {
                padding-top: env(safe-area-inset-top, 0px);
                padding-bottom: env(safe-area-inset-bottom, 0px);
            }
        }
        
        @media (max-width: 480px) {
            #gameCanvas {
                width: 100% !important;
                height: auto !important;
                max-height: 45vh;
            }
            #joystickContainer {
                width: 130px;
                height: 130px;
            }
            .joystick-base {
                width: 130px;
                height: 130px;
            }
            .joystick-stick {
                width: 50px;
                height: 50px;
            }
            #ui {
                flex-wrap: wrap;
                gap: 5px;
                justify-content: center;
            }
            .uiElement {
                font-size: 11px;
            }
        }

        .joystick-base {
            position: absolute;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(20, 40, 20, 0.7), rgba(15, 30, 15, 0.9));
            border: 2px solid #2A4A2A;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(0, 30, 0, 0.5);
        }

        .joystick-stick {
            position: absolute;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, #D4AF37, #8B7530);
            border: 2px solid #2A4A2A;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.1s;
            touch-action: none;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.4);
        }
        
        #credits {
            position: fixed;
            bottom: 8px;
            font-size: 9px;
            color: #3A4A3A;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>
    <div id="audioControls">
        <a href="index.html" id="homeBtn">‚Üê –ì–ª–∞–≤–Ω–∞—è</a>
        <button id="toggleMusic">‚ô™ –ú—É–∑—ã–∫–∞</button>
        <button id="toggleSfx">‚ô™ –ó–≤—É–∫–∏</button>
    </div>
    
    <h1 id="gameTitle">–ü–û–î –†–ê–ö–ò–¢–û–í–´–ô –ö–£–°–¢–û–ö</h1>
    <div id="subtitle">survival horror</div>
    
    <div id="ui">
        <div class="uiElement">‚ù§Ô∏è –ñ–∏–∑–Ω—å: <span id="lives">1</span></div>
        <div class="uiElement">üî¶ –§–æ–Ω–∞—Ä–∏–∫: <span id="battery">100</span> %</div>
        <div class="uiElement">üë£ –°–ª–µ–¥—ã: <span id="footprints">0</span> /5</div>
        <div class="uiElement">üå≤ –£—Ä–æ–≤–µ–Ω—å: <span id="levelIndicator">1</span> /3</div>
    </div>
    
    <div id="gameContainer">
        <canvas id="gameCanvas" width="600" height="600"></canvas>
        
        <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
        <div id="startScreen">
            <button class="startButton" onclick="startGame()">‚ñ∫ –ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
            <div class="hint">–ö–ª–∏–∫–Ω–∏ –∏–ª–∏ –Ω–∞–∂–º–∏ Enter</div>
        </div>
        
        <!-- –î–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ -->
        <div id="dialogueScreen">
            <div class="dialogueBox">
                <div class="dialogueTitle" id="dialogueTitle">–ì–ª–∞–≤–∞ 1</div>
                <div class="dialogueText" id="dialogueText">–¢–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞...</div>
                <button class="continueButton" onclick="continueGame()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
            </div>
        </div>
        
        <!-- –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã -->
        <div id="gameOver">
            <div class="endBox">
                <div class="endTitle">–ö–û–ù–ï–¶</div>
                <div class="endMessage" id="deathMessage">–í–æ–ª–∫ –Ω–∞—Å—Ç–∏–≥ —Ç–µ–±—è –≤ —á–∞—â–µ –ª–µ—Å–∞...</div>
                <button class="restartButton" onclick="restartGame()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
            </div>
        </div>
        
        <!-- –ü–æ–±–µ–¥–∞ -->
        <div id="victory">
            <div class="endBox">
                <div class="endTitle">–°–ü–ê–°–ï–ù–ò–ï!</div>
                <div class="endMessage" id="victoryMessage">
                    –¢—ã –Ω–∞—à–ª–∞ –±–∞–±—É—à–∫—É!<br><br>
                    –û–Ω–∞ –∂–¥–∞–ª–∞ —Ç–µ–±—è —É —Å—Ç–∞—Ä–æ–π –∏–∑–±—É—à–∫–∏ –Ω–∞ –∫—Ä–∞—é –ª–µ—Å–∞.<br>
                    –í–æ–ª–∫ –æ—Å—Ç–∞–ª—Å—è –ø–æ–∑–∞–¥–∏, —Ä–∞—Å—Ç–≤–æ—Ä–∏–≤—à–∏—Å—å –≤ –Ω–æ—á–Ω–æ–π —Ç—å–º–µ.
                </div>
                <button class="restartButton" onclick="restartGame()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
            </div>
        </div>
    </div>
    
    <div id="controls">WASD ‚Äî –¥–≤–∏–∂–µ–Ω–∏–µ ‚Ä¢ R ‚Äî –∑–∞–Ω–æ–≤–æ ‚Ä¢ –°–ª–µ–¥—É–π –∑–∞ —Å–ª–µ–¥–∞–º–∏ –±–∞–±—É—à–∫–∏</div>
    
    <div id="joystickContainer">
        <div class="joystick-base">
            <div class="joystick-stick" id="joystickStick"></div>
        </div>
    </div>
    
    <div id="credits">–ö–æ–º–∞–Ω–¥–∞ ¬´–ö—Ä–∞—Å–Ω–∞—è —à–∞–ø–æ—á–∫–∞¬ª: –ê.–ú–∏–Ω–µ–µ–≤, –ò.–ê–∫–∏—à–∏–Ω–∞, –ï.–ü—Ä–æ—Ö–æ—Ä–æ–≤–∞, –ù.–ü–∞—á–∫–æ—Ä–∏—è</div>
    
    <audio id="backgroundMusic" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>
    
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        const GRID_SIZE = 15;
        const CELL_SIZE = canvas.width / GRID_SIZE;
        const LIGHT_RANGE = 3;
        
        let currentLevel = 1;
        let gameStarted = false;
        let animationFrame = 0;
        
        // –î–∏–∞–ª–æ–≥–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
        const dialogues = {
            1: {
                title: "–ì–ª–∞–≤–∞ 1: –û–ø—É—à–∫–∞",
                text: "–¢—ã –ø–æ—à–ª–∞ —Å –±–∞–±—É—à–∫–æ–π –∑–∞ –≥—Ä–∏–±–∞–º–∏ –≤ –∫–∞—Ä–µ–ª—å—Å–∫–∏–π –ª–µ—Å.<br>–ù–∞ –º–≥–Ω–æ–≤–µ–Ω–∏–µ –æ—Ç–≤–ª–µ–∫–ª–∞—Å—å ‚Äî –∏ –±–∞–±—É—à–∫–∏ —Ä—è–¥–æ–º –Ω–µ —Å—Ç–∞–ª–æ.<br><br><em>–°—Ç–µ–º–Ω–µ–ª–æ. –õ–µ—Å —Å—Ç–∞–ª —á—É–∂–∏–º.</em><br><em>–ì–¥–µ-—Ç–æ —Ä—è–¥–æ–º –≤–æ—é—Ç –≤–æ–ª–∫–∏.</em><br><br>–ù–∞–π–¥–∏ —Å–ª–µ–¥—ã –±–∞–±—É—à–∫–∏ –∏ –≤—ã—Ö–æ–¥ —Å –æ–ø—É—à–∫–∏."
            },
            2: {
                title: "–ì–ª–∞–≤–∞ 2: –ß–∞—â–∞",
                text: "–°–ª–µ–¥—ã –≤–µ–¥—É—Ç –≥–ª—É–±–∂–µ –≤ –ª–µ—Å...<br>–î–µ—Ä–µ–≤—å—è –∑–¥–µ—Å—å —Å—Ç–∞—Ä—à–µ –∏ —Ç–µ–º–Ω–µ–µ.<br><br><em>–í–æ–ª–∫ –ø–æ—á—É—è–ª —Ç–µ–±—è. –û–Ω –±–ª–∏–∂–µ.</em><br><br>–ë—É–¥—å –æ—Å—Ç–æ—Ä–æ–∂–Ω–∞ ‚Äî –≤ —á–∞—â–µ –±–æ–ª—å—à–µ –ª–æ–≤—É—à–µ–∫."
            },
            3: {
                title: "–ì–ª–∞–≤–∞ 3: –õ–æ–≥–æ–≤–æ",
                text: "–¢—ã –ø–æ—á—Ç–∏ —É —Ü–µ–ª–∏.<br>–í–ø–µ—Ä–µ–¥–∏ –≤–∏–¥–Ω–µ–µ—Ç—Å—è —Å–≤–µ—Ç –∏–∑–±—É—à–∫–∏.<br><br><em>–ù–æ –≤–æ–ª–∫ –Ω–µ –æ—Ç—Å—Ç—É–ø–∞–µ—Ç.</em><br><em>–û–Ω –≥–æ–ª–æ–¥–µ–Ω –∏ –∑–æ–ª.</em><br><br>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä—ã–≤–æ–∫ ‚Äî –∏ —Ç—ã —Å–ø–∞—Å–µ–Ω–∞!"
            }
        };
        
        // –ö–∞—Ä—Ç—ã —É—Ä–æ–≤–Ω–µ–π (1 = —Å—Ç–µ–Ω–∞, 0 = –ø—Ä–æ—Ö–æ–¥)
        const levels = {
            1: [
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],
                [1,0,1,0,1,0,1,1,1,0,1,0,1,0,1],
                [1,0,1,0,0,0,0,0,1,0,0,0,1,0,1],
                [1,0,1,1,1,1,1,0,1,1,1,0,1,0,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
                [1,1,1,0,1,1,1,1,1,1,1,0,1,0,1],
                [1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],
                [1,0,1,1,1,0,1,1,1,0,1,1,1,0,1],
                [1,0,0,0,0,0,1,0,0,0,0,0,0,0,1],
                [1,1,1,1,1,0,1,0,1,1,1,1,1,0,1],
                [1,0,0,0,0,0,1,0,0,0,0,0,0,0,1],
                [1,0,1,1,1,1,1,1,1,1,1,1,1,2,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ],
            2: [
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,0,0,1,0,0,0,0,0,0,0,1],
                [1,0,1,1,1,0,1,0,1,1,1,1,1,0,1],
                [1,0,1,0,0,0,0,0,0,0,0,0,1,0,1],
                [1,0,1,0,1,1,1,1,1,1,1,0,1,0,1],
                [1,0,0,0,1,0,0,0,0,0,1,0,0,0,1],
                [1,1,1,0,1,0,1,1,1,0,1,1,1,0,1],
                [1,0,0,0,0,0,1,0,1,0,0,0,0,0,1],
                [1,0,1,1,1,0,1,0,1,1,1,0,1,1,1],
                [1,0,0,0,1,0,0,0,0,0,0,0,0,0,1],
                [1,1,1,0,1,1,1,0,1,1,1,1,1,0,1],
                [1,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
                [1,0,1,1,1,1,1,0,1,0,1,1,1,0,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,0,2,1],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ],
            3: [
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,1,0,0,0,1,0,0,0,0,0,1],
                [1,0,1,0,1,0,1,0,1,0,1,1,1,0,1],
                [1,0,1,0,0,0,1,0,0,0,0,0,1,0,1],
                [1,0,1,1,1,0,1,1,1,1,1,0,1,0,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
                [1,0,1,1,1,1,1,1,1,1,1,0,1,0,1],
                [1,0,1,0,0,0,0,0,0,0,1,0,0,0,1],
                [1,0,1,0,1,1,1,1,1,0,1,1,1,0,1],
                [1,0,0,0,1,0,0,0,0,0,0,0,0,0,1],
                [1,1,1,0,1,0,1,1,1,1,1,1,1,0,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
                [1,0,1,1,1,1,1,1,1,1,1,0,1,0,1],
                [1,0,0,0,0,0,0,0,0,0,0,0,0,2,1],
                [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
            ]
        };
        
        // –°–ª–µ–¥—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
        const levelFootprints = {
            1: [{x:2,y:3}, {x:4,y:5}, {x:6,y:7}, {x:8,y:9}, {x:10,y:11}],
            2: [{x:3,y:2}, {x:5,y:4}, {x:7,y:6}, {x:9,y:8}, {x:11,y:10}],
            3: [{x:2,y:2}, {x:4,y:4}, {x:6,y:6}, {x:8,y:8}, {x:11,y:11}]
        };
        
        // –õ–æ–≤—É—à–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–≤–Ω—è
        const levelTraps = {
            1: [{x:7, y:9}],
            2: [{x:5, y:5}, {x:9, y:9}],
            3: [{x:4, y:4}, {x:7, y:7}, {x:10, y:10}]
        };
        
        // –ù–∞—á–∞–ª—å–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –≤–æ–ª–∫–∞
        const wolfStarts = {
            1: {x: 11, y: 7},
            2: {x: 10, y: 5},
            3: {x: 9, y: 3}
        };
        
        let maze = [];
        let player = { x: 1, y: 1, facing: { x: 0, y: 1 } };
        let wolf = { x: 11, y: 7, moveTimer: 0 };
        let traps = [];
        let footprints = [];
        let exitPos = { x: 13, y: 12 };
        
        let gameState = {
            alive: true,
            won: false,
            footprintsFound: 0,
            totalFootprints: 5,
            battery: 100
        };
        
        // –ê—É–¥–∏–æ
        let musicEnabled = true;
        let sfxEnabled = true;
        const backgroundMusic = document.getElementById('backgroundMusic');
        backgroundMusic.volume = 0.25;
        
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(frequency, duration, type = 'sine') {
            if (!sfxEnabled) return;
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.value = frequency;
            oscillator.type = type;
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration);
        }
        
        function playStepSound() {
            playSound(80 + Math.random() * 40, 0.1, 'square');
        }
        
        function playDeathSound() {
            playSound(100, 0.3, 'sawtooth');
            setTimeout(() => playSound(70, 0.3, 'sawtooth'), 100);
            setTimeout(() => playSound(50, 0.5, 'sawtooth'), 200);
        }
        
        function playWinSound() {
            playSound(392, 0.15, 'sine');
            setTimeout(() => playSound(523, 0.15, 'sine'), 150);
            setTimeout(() => playSound(659, 0.15, 'sine'), 300);
            setTimeout(() => playSound(784, 0.3, 'sine'), 450);
        }
        
        function playWolfHowl() {
            if (!sfxEnabled) return;
            playSound(200, 0.4, 'sawtooth');
            setTimeout(() => playSound(180, 0.3, 'sawtooth'), 200);
            setTimeout(() => playSound(150, 0.5, 'sawtooth'), 400);
        }
        
        function playFootprintSound() {
            playSound(600, 0.1, 'sine');
            setTimeout(() => playSound(800, 0.15, 'sine'), 100);
        }
        
        function startMusic() {
            if (musicEnabled) {
                backgroundMusic.play().catch(() => {});
            }
        }
        
        function loadLevel(levelNum) {
            currentLevel = levelNum;
            maze = JSON.parse(JSON.stringify(levels[levelNum]));
            player = { x: 1, y: 1, facing: { x: 0, y: 1 } };
            wolf = { ...wolfStarts[levelNum], moveTimer: 0 };
            traps = levelTraps[levelNum].map(t => ({...t, triggered: false}));
            footprints = levelFootprints[levelNum].map(f => ({...f, found: false}));
            
            // –ù–∞–π—Ç–∏ –≤—ã—Ö–æ–¥ –Ω–∞ –∫–∞—Ä—Ç–µ
            for (let y = 0; y < GRID_SIZE; y++) {
                for (let x = 0; x < GRID_SIZE; x++) {
                    if (maze[y][x] === 2) {
                        exitPos = {x, y};
                        maze[y][x] = 0;
                    }
                }
            }
            
            gameState = {
                alive: true,
                won: false,
                footprintsFound: 0,
                totalFootprints: 5,
                battery: 100
            };
            
            document.getElementById('levelIndicator').textContent = levelNum;
            updateUI();
        }
        
        function isWall(x, y) {
            if (x < 0 || x >= GRID_SIZE || y < 0 || y >= GRID_SIZE) return true;
            return maze[y][x] === 1;
        }
        
        function updateUI() {
            document.getElementById('battery').textContent = gameState.battery;
            document.getElementById('footprints').textContent = gameState.footprintsFound;
        }
        
        function movePlayer(dx, dy) {
            if (!gameState.alive || !gameStarted || gameState.won) return;
            
            const newX = player.x + dx;
            const newY = player.y + dy;
            
            if (!isWall(newX, newY)) {
                player.x = newX;
                player.y = newY;
                player.facing = { x: dx, y: dy };
                
                playStepSound();
                
                // –ë–∞—Ç–∞—Ä–µ—è
                gameState.battery = Math.max(0, gameState.battery - 1);
                updateUI();
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–µ–¥–æ–≤
                footprints.forEach(fp => {
                    if (!fp.found && fp.x === player.x && fp.y === player.y) {
                        fp.found = true;
                        gameState.footprintsFound++;
                        playFootprintSound();
                        updateUI();
                    }
                });
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≤—É—à–µ–∫
                traps.forEach(trap => {
                    if (!trap.triggered && trap.x === player.x && trap.y === player.y) {
                        trap.triggered = true;
                        gameState.alive = false;
                        playDeathSound();
                        backgroundMusic.pause();
                        document.getElementById('deathMessage').textContent = 
                            '–¢—ã –ø–æ–ø–∞–ª–∞ –≤ –ª–æ–≤—É—à–∫—É –±—Ä–∞–∫–æ–Ω—å–µ—Ä–æ–≤...';
                        document.getElementById('gameOver').style.display = 'flex';
                    }
                });
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—ã—Ö–æ–¥–∞
                if (player.x === exitPos.x && player.y === exitPos.y) {
                    if (currentLevel < 3) {
                        // –°–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å
                        currentLevel++;
                        showDialogue(currentLevel);
                    } else {
                        // –ü–æ–±–µ–¥–∞!
                        gameState.won = true;
                        playWinSound();
                        backgroundMusic.pause();
                        document.getElementById('victoryMessage').innerHTML = 
                            `–¢—ã –Ω–∞—à–ª–∞ –±–∞–±—É—à–∫—É!<br><br>
                            –°–ª–µ–¥–æ–≤ –Ω–∞–π–¥–µ–Ω–æ: ${gameState.footprintsFound}/5<br>
                            –ë–∞—Ç–∞—Ä–µ—è: ${gameState.battery}%<br><br>
                            –ë–∞–±—É—à–∫–∞ –∂–¥–∞–ª–∞ —Ç–µ–±—è —É —Å—Ç–∞—Ä–æ–π –∏–∑–±—É—à–∫–∏.<br>
                            –í–æ–ª–∫ –æ—Å—Ç–∞–ª—Å—è –ø–æ–∑–∞–¥–∏, —Ä–∞—Å—Ç–≤–æ—Ä–∏–≤—à–∏—Å—å –≤ –Ω–æ—á–Ω–æ–π —Ç—å–º–µ.`;
                        document.getElementById('victory').style.display = 'flex';
                    }
                }
                
                // –î–≤–∏–∂–µ–Ω–∏–µ –≤–æ–ª–∫–∞
                moveWolf();
                
                draw();
            }
        }
        
        function moveWolf() {
            wolf.moveTimer++;
            
            // –°–∫–æ—Ä–æ—Å—Ç—å –≤–æ–ª–∫–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è
            const wolfSpeed = 4 - currentLevel; // –£—Ä–æ–≤–µ–Ω—å 1: –∫–∞–∂–¥—ã–µ 3 —Ö–æ–¥–∞, —É—Ä–æ–≤–µ–Ω—å 3: –∫–∞–∂–¥—ã–π —Ö–æ–¥
            
            if (wolf.moveTimer >= wolfSpeed) {
                wolf.moveTimer = 0;
                
                // –í–æ–ª–∫ –ø—Ä–µ—Å–ª–µ–¥—É–µ—Ç –∏–≥—Ä–æ–∫–∞
                const dx = player.x - wolf.x;
                const dy = player.y - wolf.y;
                
                let moveX = 0, moveY = 0;
                
                // –í—ã–±–∏—Ä–∞–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫ –∏–≥—Ä–æ–∫—É
                if (Math.abs(dx) > Math.abs(dy)) {
                    moveX = dx > 0 ? 1 : -1;
                } else {
                    moveY = dy > 0 ? 1 : -1;
                }
                
                // –ü—Ä–æ–±—É–µ–º –¥–≤–∏–≥–∞—Ç—å—Å—è
                if (!isWall(wolf.x + moveX, wolf.y + moveY)) {
                    wolf.x += moveX;
                    wolf.y += moveY;
                } else if (!isWall(wolf.x, wolf.y + (dy > 0 ? 1 : -1))) {
                    wolf.y += dy > 0 ? 1 : -1;
                } else if (!isWall(wolf.x + (dx > 0 ? 1 : -1), wolf.y)) {
                    wolf.x += dx > 0 ? 1 : -1;
                }
                
                // –í–æ–π –≤–æ–ª–∫–∞
                const dist = Math.abs(player.x - wolf.x) + Math.abs(player.y - wolf.y);
                if (dist <= 4 && Math.random() < 0.25) {
                    playWolfHowl();
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –∏–≥—Ä–æ–∫–æ–º
            if (wolf.x === player.x && wolf.y === player.y) {
                gameState.alive = false;
                playDeathSound();
                backgroundMusic.pause();
                document.getElementById('deathMessage').textContent = 
                    '–í–æ–ª–∫ –Ω–∞—Å—Ç–∏–≥ —Ç–µ–±—è –≤ —á–∞—â–µ –ª–µ—Å–∞...';
                document.getElementById('gameOver').style.display = 'flex';
            }
        }
        
        function seededRandom(seed) {
            const x = Math.sin(seed) * 10000;
            return x - Math.floor(x);
        }
        
        // –†–∏—Å–æ–≤–∞–Ω–∏–µ –¥–µ—Ä–µ–≤–∞
        function drawTree(x, y, seed, lit) {
            const cx = x * CELL_SIZE + CELL_SIZE / 2;
            const cy = y * CELL_SIZE + CELL_SIZE / 2;
            const size = CELL_SIZE * 0.4;
            
            const variation = seededRandom(seed);
            
            if (lit) {
                // –°—Ç–≤–æ–ª
                ctx.fillStyle = '#3D2817';
                ctx.fillRect(cx - 3, cy, 6, size * 0.5);
                
                // –ö—Ä–æ–Ω–∞ - –¥–≤–∞ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞
                const green1 = `rgb(${30 + variation * 20}, ${60 + variation * 30}, ${30 + variation * 15})`;
                const green2 = `rgb(${20 + variation * 15}, ${45 + variation * 25}, ${20 + variation * 10})`;
                
                ctx.fillStyle = green1;
                ctx.beginPath();
                ctx.moveTo(cx, cy - size * 0.8);
                ctx.lineTo(cx - size * 0.6, cy + size * 0.1);
                ctx.lineTo(cx + size * 0.6, cy + size * 0.1);
                ctx.closePath();
                ctx.fill();
                
                ctx.fillStyle = green2;
                ctx.beginPath();
                ctx.moveTo(cx, cy - size * 0.4);
                ctx.lineTo(cx - size * 0.5, cy + size * 0.4);
                ctx.lineTo(cx + size * 0.5, cy + size * 0.4);
                ctx.closePath();
                ctx.fill();
            } else {
                // –¢—ë–º–Ω—ã–π —Å–∏–ª—É—ç—Ç
                ctx.fillStyle = '#0A150A';
                ctx.beginPath();
                ctx.moveTo(cx, cy - size * 0.8);
                ctx.lineTo(cx - size * 0.6, cy + size * 0.4);
                ctx.lineTo(cx + size * 0.6, cy + size * 0.4);
                ctx.closePath();
                ctx.fill();
            }
        }
        
        // –†–∏—Å–æ–≤–∞–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
        function drawPlayer() {
            const cx = player.x * CELL_SIZE + CELL_SIZE / 2;
            const cy = player.y * CELL_SIZE + CELL_SIZE / 2;
            const s = CELL_SIZE / 2.2;
            
            // –¢–µ–Ω—å
            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.beginPath();
            ctx.ellipse(cx, cy + s * 0.5, s * 0.4, s * 0.15, 0, 0, Math.PI * 2);
            ctx.fill();
            
            // –ü–ª–∞—â (—Ä–∞–∑–≤–µ–≤–∞–µ—Ç—Å—è) - –Ø–†–ö–ò–ô
            const waveOffset = Math.sin(animationFrame * 0.1) * 2;
            ctx.fillStyle = '#CC0000';
            ctx.beginPath();
            ctx.moveTo(cx - s * 0.5, cy - s * 0.3);
            ctx.quadraticCurveTo(cx - s * 0.7 + waveOffset, cy + s * 0.3, cx - s * 0.4, cy + s * 0.6);
            ctx.lineTo(cx + s * 0.4, cy + s * 0.6);
            ctx.quadraticCurveTo(cx + s * 0.7 - waveOffset, cy + s * 0.3, cx + s * 0.5, cy - s * 0.3);
            ctx.closePath();
            ctx.fill();
            
            // –ö–∞–ø—é—à–æ–Ω - –Ø–†–ö–ò–ô
            ctx.fillStyle = '#DD2222';
            ctx.beginPath();
            ctx.arc(cx, cy - s * 0.2, s * 0.5, Math.PI, 0, false);
            ctx.fill();
            
            ctx.fillStyle = '#CC0000';
            ctx.beginPath();
            ctx.moveTo(cx - s * 0.45, cy - s * 0.2);
            ctx.quadraticCurveTo(cx, cy - s * 0.9, cx + s * 0.45, cy - s * 0.2);
            ctx.closePath();
            ctx.fill();
            
            // –õ–∏—Ü–æ
            ctx.fillStyle = '#FFDAB9';
            ctx.beginPath();
            ctx.arc(cx, cy - s * 0.15, s * 0.32, 0, Math.PI * 2);
            ctx.fill();
            
            // –ì–ª–∞–∑–∞
            ctx.fillStyle = '#2F1810';
            ctx.beginPath();
            ctx.arc(cx - s * 0.12, cy - s * 0.22, s * 0.06, 0, Math.PI * 2);
            ctx.arc(cx + s * 0.12, cy - s * 0.22, s * 0.06, 0, Math.PI * 2);
            ctx.fill();
            
            // –ë–ª–∏–∫–∏ –≥–ª–∞–∑
            ctx.fillStyle = '#FFFFFF';
            ctx.beginPath();
            ctx.arc(cx - s * 0.1, cy - s * 0.24, s * 0.02, 0, Math.PI * 2);
            ctx.arc(cx + s * 0.14, cy - s * 0.24, s * 0.02, 0, Math.PI * 2);
            ctx.fill();
            
            // –ö–æ—Ä–∑–∏–Ω–∫–∞
            ctx.fillStyle = '#8B4513';
            ctx.beginPath();
            ctx.ellipse(cx + s * 0.35, cy + s * 0.35, s * 0.2, s * 0.15, 0.3, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = '#5D3A1A';
            ctx.lineWidth = 1.5;
            ctx.beginPath();
            ctx.arc(cx + s * 0.35, cy + s * 0.2, s * 0.15, Math.PI, 0, true);
            ctx.stroke();
            
            // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–æ–Ω–∞—Ä–∏–∫–∞
            const fx = cx + player.facing.x * s * 0.6;
            const fy = cy + player.facing.y * s * 0.6;
            
            // –õ—É—á —Ñ–æ–Ω–∞—Ä–∏–∫–∞ - –Ø–†–ö–ò–ô
            const gradient = ctx.createRadialGradient(cx, cy, 0, fx, fy, s * 2);
            gradient.addColorStop(0, 'rgba(255, 240, 150, 0.5)');
            gradient.addColorStop(0.5, 'rgba(255, 220, 100, 0.3)');
            gradient.addColorStop(1, 'rgba(255, 220, 100, 0)');
            ctx.fillStyle = gradient;
            ctx.beginPath();
            ctx.arc(fx, fy, s * 2, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // –î–µ—Ç–∞–ª—å–Ω—ã–π –≤–æ–ª–∫
        function drawWolf(x, y, lit) {
            const cx = x * CELL_SIZE + CELL_SIZE / 2;
            const cy = y * CELL_SIZE + CELL_SIZE / 2;
            const s = CELL_SIZE / 2.2;
            
            if (lit) {
                // –•–≤–æ—Å—Ç
                ctx.fillStyle = '#2A2A2A';
                ctx.beginPath();
                ctx.moveTo(cx - s * 0.5, cy + s * 0.2);
                ctx.quadraticCurveTo(cx - s * 0.9, cy - s * 0.1, cx - s * 0.7, cy + s * 0.4);
                ctx.quadraticCurveTo(cx - s * 0.5, cy + s * 0.5, cx - s * 0.4, cy + s * 0.3);
                ctx.closePath();
                ctx.fill();
                
                // –ó–∞–¥–Ω–∏–µ –ª–∞–ø—ã
                ctx.fillStyle = '#2A2A2A';
                ctx.beginPath();
                ctx.ellipse(cx - s * 0.25, cy + s * 0.55, s * 0.12, s * 0.2, -0.2, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(cx + s * 0.05, cy + s * 0.55, s * 0.12, s * 0.2, 0.2, 0, Math.PI * 2);
                ctx.fill();
                
                // –¢–µ–ª–æ –≤–æ–ª–∫–∞ - –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ
                ctx.fillStyle = '#3A3A3A';
                ctx.beginPath();
                ctx.ellipse(cx, cy + s * 0.15, s * 0.6, s * 0.4, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // –ì—Ä—É–¥—å (—Å–≤–µ—Ç–ª–µ–µ)
                ctx.fillStyle = '#4A4A4A';
                ctx.beginPath();
                ctx.ellipse(cx + s * 0.25, cy + s * 0.2, s * 0.25, s * 0.3, 0.3, 0, Math.PI * 2);
                ctx.fill();
                
                // –ü–µ—Ä–µ–¥–Ω–∏–µ –ª–∞–ø—ã
                ctx.fillStyle = '#2A2A2A';
                ctx.beginPath();
                ctx.ellipse(cx + s * 0.35, cy + s * 0.55, s * 0.1, s * 0.18, 0.1, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(cx + s * 0.55, cy + s * 0.5, s * 0.1, s * 0.18, 0.2, 0, Math.PI * 2);
                ctx.fill();
                
                // –®–µ—è
                ctx.fillStyle = '#3A3A3A';
                ctx.beginPath();
                ctx.ellipse(cx + s * 0.35, cy - s * 0.1, s * 0.25, s * 0.3, 0.4, 0, Math.PI * 2);
                ctx.fill();
                
                // –ì–æ–ª–æ–≤–∞
                ctx.fillStyle = '#4A4A4A';
                ctx.beginPath();
                ctx.ellipse(cx + s * 0.5, cy - s * 0.25, s * 0.35, s * 0.3, 0.3, 0, Math.PI * 2);
                ctx.fill();
                
                // –ú–æ—Ä–¥–∞
                ctx.fillStyle = '#3A3A3A';
                ctx.beginPath();
                ctx.ellipse(cx + s * 0.75, cy - s * 0.15, s * 0.2, s * 0.15, 0.2, 0, Math.PI * 2);
                ctx.fill();
                
                // –£—à–∏
                ctx.fillStyle = '#3A3A3A';
                ctx.beginPath();
                ctx.moveTo(cx + s * 0.3, cy - s * 0.4);
                ctx.lineTo(cx + s * 0.35, cy - s * 0.75);
                ctx.lineTo(cx + s * 0.5, cy - s * 0.45);
                ctx.closePath();
                ctx.fill();
                
                ctx.beginPath();
                ctx.moveTo(cx + s * 0.5, cy - s * 0.45);
                ctx.lineTo(cx + s * 0.6, cy - s * 0.8);
                ctx.lineTo(cx + s * 0.7, cy - s * 0.4);
                ctx.closePath();
                ctx.fill();
                
                // –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —á–∞—Å—Ç—å —É—à–µ–π
                ctx.fillStyle = '#5A4A4A';
                ctx.beginPath();
                ctx.moveTo(cx + s * 0.35, cy - s * 0.45);
                ctx.lineTo(cx + s * 0.38, cy - s * 0.65);
                ctx.lineTo(cx + s * 0.48, cy - s * 0.48);
                ctx.closePath();
                ctx.fill();
                
                // –ì–ª–∞–∑–∞ (–≥–æ—Ä—è—â–∏–µ) - –Ø–†–ö–ò–ï –û–†–ê–ù–ñ–ï–í–´–ï
                ctx.fillStyle = '#FF6600';
                ctx.shadowColor = '#FF4400';
                ctx.shadowBlur = 15;
                ctx.beginPath();
                ctx.ellipse(cx + s * 0.45, cy - s * 0.35, s * 0.1, s * 0.08, 0.2, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(cx + s * 0.65, cy - s * 0.3, s * 0.1, s * 0.08, 0.2, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
                
                // –ó—Ä–∞—á–∫–∏
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.ellipse(cx + s * 0.47, cy - s * 0.35, s * 0.04, s * 0.05, 0, 0, Math.PI * 2);
                ctx.fill();
                ctx.beginPath();
                ctx.ellipse(cx + s * 0.67, cy - s * 0.3, s * 0.04, s * 0.05, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // –ù–æ—Å
                ctx.fillStyle = '#1A1A1A';
                ctx.beginPath();
                ctx.ellipse(cx + s * 0.88, cy - s * 0.12, s * 0.08, s * 0.06, 0, 0, Math.PI * 2);
                ctx.fill();
                
                // –†–æ—Ç/–ø–∞—Å—Ç—å
                ctx.strokeStyle = '#1A1A1A';
                ctx.lineWidth = 1.5;
                ctx.beginPath();
                ctx.moveTo(cx + s * 0.85, cy - s * 0.08);
                ctx.quadraticCurveTo(cx + s * 0.75, cy + s * 0.02, cx + s * 0.6, cy - s * 0.05);
                ctx.stroke();
                
                // –ö–ª—ã–∫–∏
                ctx.fillStyle = '#FFFFFF';
                ctx.beginPath();
                ctx.moveTo(cx + s * 0.78, cy - s * 0.05);
                ctx.lineTo(cx + s * 0.75, cy + s * 0.08);
                ctx.lineTo(cx + s * 0.72, cy - s * 0.05);
                ctx.closePath();
                ctx.fill();
                
            } else {
                // –¢–æ–ª—å–∫–æ –≥–ª–∞–∑–∞ –≤ —Ç–µ–º–Ω–æ—Ç–µ - –Ø–†–ö–ò–ï
                const dist = Math.abs(player.x - x) + Math.abs(player.y - y);
                if (dist <= 6) {
                    ctx.fillStyle = '#FF6600';
                    ctx.shadowColor = '#FF4400';
                    ctx.shadowBlur = 20;
                    ctx.beginPath();
                    ctx.arc(cx - s * 0.15, cy - s * 0.1, s * 0.15, 0, Math.PI * 2);
                    ctx.arc(cx + s * 0.15, cy - s * 0.1, s * 0.15, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.shadowBlur = 0;
                }
            }
        }
        
        function isLit(x, y) {
            if (x === player.x && y === player.y) return true;
            for (let i = 1; i <= LIGHT_RANGE; i++) {
                const checkX = player.x + player.facing.x * i;
                const checkY = player.y + player.facing.y * i;
                if (checkX === x && checkY === y) return true;
                if (isWall(checkX, checkY)) break;
            }
            return false;
        }
        
        function draw() {
            animationFrame++;
            
            // –§–æ–Ω ‚Äî –Ω–æ—á–Ω–æ–π –ª–µ—Å
            ctx.fillStyle = '#050A08';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º –∫–∞—Ä—Ç—É
            for (let y = 0; y < GRID_SIZE; y++) {
                for (let x = 0; x < GRID_SIZE; x++) {
                    const lit = isLit(x, y);
                    const px = x * CELL_SIZE;
                    const py = y * CELL_SIZE;
                    
                    if (maze[y][x] === 1) {
                        // –°—Ç–µ–Ω–∞ = –¥–µ—Ä–µ–≤–æ
                        drawTree(x, y, x * 17 + y * 31, lit);
                    } else {
                        // –ü–æ–ª
                        if (lit) {
                            ctx.fillStyle = '#1E2E1E';
                            ctx.fillRect(px, py, CELL_SIZE, CELL_SIZE);
                            
                            // –ú–æ—Ö –∏ –∫–∞–º–Ω–∏
                            const seed = x * 13 + y * 29;
                            if (seededRandom(seed) > 0.6) {
                                ctx.fillStyle = 'rgba(60, 90, 50, 0.3)';
                                ctx.beginPath();
                                ctx.arc(px + CELL_SIZE * 0.3, py + CELL_SIZE * 0.7, CELL_SIZE * 0.1, 0, Math.PI * 2);
                                ctx.fill();
                            }
                            if (seededRandom(seed + 100) > 0.7) {
                                ctx.fillStyle = 'rgba(80, 80, 70, 0.4)';
                                ctx.beginPath();
                                ctx.ellipse(px + CELL_SIZE * 0.7, py + CELL_SIZE * 0.5, CELL_SIZE * 0.08, CELL_SIZE * 0.05, 0, 0, Math.PI * 2);
                                ctx.fill();
                            }
                        } else {
                            ctx.fillStyle = '#060C08';
                            ctx.fillRect(px, py, CELL_SIZE, CELL_SIZE);
                        }
                    }
                }
            }
            
            // –°–≤–µ—Ç–æ–≤–æ–π –ª—É—á
            for (let i = 1; i <= LIGHT_RANGE; i++) {
                const lx = player.x + player.facing.x * i;
                const ly = player.y + player.facing.y * i;
                if (isWall(lx, ly)) break;
                
                const alpha = (1 - i / LIGHT_RANGE) * 0.35;
                const gradient = ctx.createRadialGradient(
                    lx * CELL_SIZE + CELL_SIZE / 2, ly * CELL_SIZE + CELL_SIZE / 2, 0,
                    lx * CELL_SIZE + CELL_SIZE / 2, ly * CELL_SIZE + CELL_SIZE / 2, CELL_SIZE
                );
                gradient.addColorStop(0, `rgba(255, 228, 160, ${alpha})`);
                gradient.addColorStop(1, 'rgba(255, 228, 160, 0)');
                ctx.fillStyle = gradient;
                ctx.fillRect(lx * CELL_SIZE, ly * CELL_SIZE, CELL_SIZE, CELL_SIZE);
            }
            
            // –°–ª–µ–¥—ã
            footprints.forEach(fp => {
                if (!fp.found && isLit(fp.x, fp.y)) {
                    const fx = fp.x * CELL_SIZE + CELL_SIZE / 2;
                    const fy = fp.y * CELL_SIZE + CELL_SIZE / 2;
                    ctx.fillStyle = 'rgba(139, 90, 43, 0.7)';
                    ctx.beginPath();
                    ctx.ellipse(fx - 5, fy, 4, 6, -0.3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.beginPath();
                    ctx.ellipse(fx + 5, fy - 3, 4, 6, 0.3, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
            
            // –õ–æ–≤—É—à–∫–∏ (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)
            traps.forEach(trap => {
                if (!trap.triggered && isLit(trap.x, trap.y)) {
                    const tx = trap.x * CELL_SIZE + CELL_SIZE / 2;
                    const ty = trap.y * CELL_SIZE + CELL_SIZE / 2;
                    
                    ctx.fillStyle = 'rgba(100, 60, 30, 0.6)';
                    ctx.beginPath();
                    ctx.ellipse(tx, ty, CELL_SIZE * 0.3, CELL_SIZE * 0.15, 0, 0, Math.PI * 2);
                    ctx.fill();
                    
                    ctx.strokeStyle = '#5A3A1A';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.arc(tx, ty, CELL_SIZE * 0.25, 0, Math.PI * 2);
                    ctx.stroke();
                }
            });
            
            // –í—ã—Ö–æ–¥
            if (isLit(exitPos.x, exitPos.y)) {
                const ex = exitPos.x * CELL_SIZE + CELL_SIZE / 2;
                const ey = exitPos.y * CELL_SIZE + CELL_SIZE / 2;
                
                const gradient = ctx.createRadialGradient(ex, ey, 0, ex, ey, CELL_SIZE);
                gradient.addColorStop(0, 'rgba(255, 220, 150, 0.5)');
                gradient.addColorStop(1, 'rgba(255, 220, 150, 0)');
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.arc(ex, ey, CELL_SIZE, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#D4AF37';
                ctx.font = 'bold 20px Georgia';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('‚õ∫', ex, ey);
            }
            
            // –í–æ–ª–∫
            drawWolf(wolf.x, wolf.y, isLit(wolf.x, wolf.y));
            
            // –ò–≥—Ä–æ–∫
            drawPlayer();
            
            // –í–∏–Ω—å–µ—Ç–∫–∞
            const vignette = ctx.createRadialGradient(
                canvas.width / 2, canvas.height / 2, canvas.width * 0.3,
                canvas.width / 2, canvas.height / 2, canvas.width * 0.7
            );
            vignette.addColorStop(0, 'rgba(0, 0, 0, 0)');
            vignette.addColorStop(1, 'rgba(0, 0, 0, 0.4)');
            ctx.fillStyle = vignette;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        
        function showDialogue(level) {
            const dialogue = dialogues[level];
            document.getElementById('dialogueTitle').textContent = dialogue.title;
            document.getElementById('dialogueText').innerHTML = dialogue.text;
            document.getElementById('dialogueScreen').style.display = 'flex';
        }
        
        function continueGame() {
            document.getElementById('dialogueScreen').style.display = 'none';
            loadLevel(currentLevel);
            draw();
            gameLoop();
        }
        
        function startGame() {
            gameStarted = true;
            document.getElementById('startScreen').style.display = 'none';
            showDialogue(1);
            startMusic();
        }
        
        function gameLoop() {
            if (gameStarted && gameState.alive && !gameState.won) {
                draw();
                requestAnimationFrame(gameLoop);
            }
        }
        
        function restartGame() {
            currentLevel = 1;
            document.getElementById('lives').textContent = '1';
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('victory').style.display = 'none';
            
            showDialogue(1);
            startMusic();
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
        document.addEventListener('keydown', (e) => {
            if (!gameStarted && (e.key === 'Enter' || e.key === ' ')) {
                startGame();
                return;
            }
            
            switch(e.key.toLowerCase()) {
                case 'w': case '—Ü': case 'arrowup':
                    movePlayer(0, -1); break;
                case 's': case '—ã': case 'arrowdown':
                    movePlayer(0, 1); break;
                case 'a': case '—Ñ': case 'arrowleft':
                    movePlayer(-1, 0); break;
                case 'd': case '–≤': case 'arrowright':
                    movePlayer(1, 0); break;
                case 'r': case '–∫':
                    restartGame(); break;
            }
        });
        
        // –ê—É–¥–∏–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
        document.getElementById('toggleMusic').addEventListener('click', function() {
            musicEnabled = !musicEnabled;
            if (musicEnabled && gameStarted) {
                backgroundMusic.play();
                this.textContent = '‚ô™ –ú—É–∑—ã–∫–∞';
            } else {
                backgroundMusic.pause();
                this.textContent = '‚ô™ –í—ã–∫–ª';
            }
        });
        
        document.getElementById('toggleSfx').addEventListener('click', function() {
            sfxEnabled = !sfxEnabled;
            this.textContent = sfxEnabled ? '‚ô™ –ó–≤—É–∫–∏' : '‚ô™ –í—ã–∫–ª';
        });
        
        // –ê–≤—Ç–æ—Å—Ç–∞—Ä—Ç –º—É–∑—ã–∫–∏ –ø–æ –∫–ª–∏–∫—É
        let musicStarted = false;
        document.addEventListener('click', () => {
            if (!musicStarted && musicEnabled && gameStarted) {
                startMusic();
                musicStarted = true;
            }
        }, { once: false });

        // –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥–∂–æ–π—Å—Ç–∏–∫
        const joystickStick = document.getElementById('joystickStick');
        const joystickContainer = document.getElementById('joystickContainer');

        let joystickActive = false;
        let joystickCenterX = 0;
        let joystickCenterY = 0;
        let lastMoveTime = 0;

        function handleJoystickStart(e) {
            e.preventDefault();
            joystickActive = true;
            const rect = joystickContainer.getBoundingClientRect();
            joystickCenterX = rect.left + rect.width / 2;
            joystickCenterY = rect.top + rect.height / 2;
            
            if (!gameStarted) startGame();
        }

        function handleJoystickMove(e) {
            if (!joystickActive) return;
            e.preventDefault();
            
            const touch = e.touches ? e.touches[0] : e;
            const dx = touch.clientX - joystickCenterX;
            const dy = touch.clientY - joystickCenterY;
            
            const distance = Math.min(Math.sqrt(dx * dx + dy * dy), 45);
            const angle = Math.atan2(dy, dx);
            
            const stickX = Math.cos(angle) * distance;
            const stickY = Math.sin(angle) * distance;
            
            joystickStick.style.transform = `translate(calc(-50% + ${stickX}px), calc(-50% + ${stickY}px))`;
            
            const now = Date.now();
            if (distance > 20 && now - lastMoveTime > 150) {
                lastMoveTime = now;
                
                if (Math.abs(dx) > Math.abs(dy)) {
                    movePlayer(dx > 0 ? 1 : -1, 0);
                } else {
                    movePlayer(0, dy > 0 ? 1 : -1);
                }
            }
        }

        function handleJoystickEnd(e) {
            joystickActive = false;
            joystickStick.style.transform = 'translate(-50%, -50%)';
        }

        joystickContainer.addEventListener('touchstart', handleJoystickStart, { passive: false });
        joystickContainer.addEventListener('touchmove', handleJoystickMove, { passive: false });
        joystickContainer.addEventListener('touchend', handleJoystickEnd);
        joystickContainer.addEventListener('mousedown', handleJoystickStart);
        document.addEventListener('mousemove', handleJoystickMove);
        document.addEventListener('mouseup', handleJoystickEnd);
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        loadLevel(1);
        draw();
    </script>
</body>
</html>
